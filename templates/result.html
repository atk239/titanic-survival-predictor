<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Result - Titanic Survival Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Top Controls -->
    <div class="container mt-3">
        <div class="d-flex justify-content-end gap-2">
            <!-- Language Toggle -->
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-secondary btn-sm lang-btn active" data-lang="en">EN</button>
                <button type="button" class="btn btn-outline-secondary btn-sm lang-btn" data-lang="ar">ÿπÿ±ÿ®Ÿä</button>
            </div>
            <!-- Theme Toggle -->
            <button type="button" class="btn btn-outline-secondary btn-sm" id="themeToggle">
                <span class="theme-icon">üåô</span>
            </button>
        </div>
    </div>

    <div class="container mt-3">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card shadow">
                    <div class="card-header {% if survived %}bg-success{% else %}bg-danger{% endif %} text-white">
                        <h3 class="mb-0 text-center" data-en="Prediction Result" data-ar="ŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ™ŸÜÿ®ÿ§">Prediction Result</h3>
                    </div>
                    <div class="card-body text-center">
                        <div class="mb-4">
                            {% if survived %}
                            <h2 class="text-success" data-en="Survived" data-ar="ŸÜÿ¨ÿß">Survived</h2>
                            <p class="lead" data-en="This passenger would likely have survived!" data-ar="ŸÖŸÜ ÿßŸÑŸÖÿ±ÿ¨ÿ≠ ÿ£ŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßŸÉÿ® ŸÇÿØ ŸÜÿ¨ÿß!">This passenger would likely have survived!</p>
                            {% else %}
                            <h2 class="text-danger" data-en="Did Not Survive" data-ar="ŸÑŸÖ ŸäŸÜÿ¨Ÿè">Did Not Survive</h2>
                            <p class="lead" data-en="This passenger would likely not have survived." data-ar="ŸÖŸÜ ÿßŸÑŸÖÿ±ÿ¨ÿ≠ ÿ£ŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßŸÉÿ® ŸÑŸÖ ŸäŸÜÿ¨Ÿè.">This passenger would likely not have survived.</p>
                            {% endif %}
                        </div>

                        <div class="mb-4">
                            <h4 data-en="Survival Probability" data-ar="ÿßÿ≠ÿ™ŸÖÿßŸÑŸäÿ© ÿßŸÑŸÜÿ¨ÿßÿ©">Survival Probability</h4>
                            <div class="progress" style="height: 30px;">
                                <div class="progress-bar {% if probability >= 50 %}bg-success{% else %}bg-danger{% endif %}"
                                     role="progressbar"
                                     style="width: {{ probability }}%;"
                                     aria-valuenow="{{ probability }}"
                                     aria-valuemin="0"
                                     aria-valuemax="100">
                                    {{ "%.1f"|format(probability) }}%
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <h5 data-en="Passenger Details" data-ar="ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ±ÿßŸÉÿ®">Passenger Details</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th data-en="Class" data-ar="ÿßŸÑÿØÿ±ÿ¨ÿ©">Class</th>
                                    <td>
                                        <span data-en="{{ pclass }}{% if pclass == 1 %}st{% elif pclass == 2 %}nd{% else %}rd{% endif %} Class"
                                              data-ar="ÿßŸÑÿØÿ±ÿ¨ÿ© {% if pclass == 1 %}ÿßŸÑÿ£ŸàŸÑŸâ{% elif pclass == 2 %}ÿßŸÑÿ´ÿßŸÜŸäÿ©{% else %}ÿßŸÑÿ´ÿßŸÑÿ´ÿ©{% endif %}">
                                            {{ pclass }}{% if pclass == 1 %}st{% elif pclass == 2 %}nd{% else %}rd{% endif %} Class
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <th data-en="Sex" data-ar="ÿßŸÑÿ¨ŸÜÿ≥">Sex</th>
                                    <td>
                                        <span data-en="{{ sex }}" data-ar="{% if sex == 'Female' %}ÿ£ŸÜÿ´Ÿâ{% else %}ÿ∞ŸÉÿ±{% endif %}">{{ sex }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th data-en="Marital Status" data-ar="ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπŸäÿ©">Marital Status</th>
                                    <td>
                                        <span data-en="{{ marital_status }}"
                                              data-ar="{% if marital_status == 'Married' %}ŸÖÿ™ÿ≤Ÿàÿ¨{% elif marital_status == 'Widowed' %}ÿ£ÿ±ŸÖŸÑ{% else %}ÿ£ÿπÿ≤ÿ®{% endif %}">
                                            {{ marital_status }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <th data-en="Age" data-ar="ÿßŸÑÿπŸÖÿ±">Age</th>
                                    <td>
                                        <span data-en="{{ age }} years" data-ar="{{ age }} ÿ≥ŸÜÿ©">{{ age }} years</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th data-en="Height" data-ar="ÿßŸÑÿ∑ŸàŸÑ">Height</th>
                                    <td>
                                        <span data-en="{{ height }} cm" data-ar="{{ height }} ÿ≥ŸÖ">{{ height }} cm</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th data-en="Fare" data-ar="ÿßŸÑÿ£ÿ¨ÿ±ÿ©">Fare</th>
                                    <td>¬£{{ "%.2f"|format(fare) }}</td>
                                </tr>
                            </table>
                        </div>

                        <a href="/" class="btn btn-primary btn-lg" data-en="Make Another Prediction" data-ar="ŸÇŸÖ ÿ®ÿ™ŸÜÿ®ÿ§ ÿ¢ÿÆÿ±">Make Another Prediction</a>
                        <button type="button" class="btn btn-outline-secondary btn-lg ms-2" data-bs-toggle="modal" data-bs-target="#feedbackModal" data-en="Rate This" data-ar="ŸÇŸäŸëŸÖ Ÿáÿ∞ÿß">
                            Rate This
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="feedbackModalLabel" data-en="How was your experience?" data-ar="ŸÉŸäŸÅ ŸÉÿßŸÜÿ™ ÿ™ÿ¨ÿ±ÿ®ÿ™ŸÉÿü">How was your experience?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <p class="mb-4" data-en="Please rate our prediction service:" data-ar="Ÿäÿ±ÿ¨Ÿâ ÿ™ŸÇŸäŸäŸÖ ÿÆÿØŸÖÿ© ÿßŸÑÿ™ŸÜÿ®ÿ§ ŸÑÿØŸäŸÜÿß:">Please rate our prediction service:</p>
                    <div class="feedback-emojis d-flex justify-content-center gap-3">
                        <button class="emoji-btn btn btn-outline-danger" data-rating="bad" title="Bad">
                            <span class="emoji">üòû</span>
                            <span class="emoji-label" data-en="Bad" data-ar="ÿ≥Ÿäÿ°">Bad</span>
                        </button>
                        <button class="emoji-btn btn btn-outline-warning" data-rating="okay" title="Okay">
                            <span class="emoji">üòê</span>
                            <span class="emoji-label" data-en="Okay" data-ar="ŸÖŸÇÿ®ŸàŸÑ">Okay</span>
                        </button>
                        <button class="emoji-btn btn btn-outline-success" data-rating="good" title="Good">
                            <span class="emoji">üòä</span>
                            <span class="emoji-label" data-en="Good" data-ar="ÿ¨ŸäÿØ">Good</span>
                        </button>
                        <button class="emoji-btn btn btn-outline-primary" data-rating="excellent" title="Excellent">
                            <span class="emoji">ü§©</span>
                            <span class="emoji-label" data-en="Excellent" data-ar="ŸÖŸÖÿ™ÿßÿ≤">Excellent</span>
                        </button>
                    </div>
                    <div id="feedbackMessage" class="mt-4" style="display: none;">
                        <div class="alert alert-success">
                            <strong data-en="Thank you!" data-ar="ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ!">Thank you!</strong>
                            <span data-en="Your feedback has been submitted." data-ar="ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÇŸäŸäŸÖŸÉ.">Your feedback has been submitted.</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-en="Close" data-ar="ÿ•ÿ∫ŸÑÿßŸÇ">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Language switching
        let currentLang = localStorage.getItem('lang') || 'en';

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);

            // Update HTML direction
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            // Update all translatable elements
            document.querySelectorAll('[data-en]').forEach(el => {
                el.textContent = el.getAttribute(`data-${lang}`);
            });

            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
        }

        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
        });

        // Theme switching
        let currentTheme = localStorage.getItem('theme') || 'light';

        function setTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('theme', theme);
            document.body.classList.toggle('dark-mode', theme === 'dark');
            document.querySelector('.theme-icon').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        document.getElementById('themeToggle').addEventListener('click', () => {
            setTheme(currentTheme === 'light' ? 'dark' : 'light');
        });

        // Initialize on page load
        setLanguage(currentLang);
        setTheme(currentTheme);

        // Feedback functionality
        document.querySelectorAll('.emoji-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const rating = this.dataset.rating;

                fetch('/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ rating: rating })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('feedbackMessage').style.display = 'block';
                    document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('active', 'selected'));
                    this.classList.add('selected');

                    setTimeout(() => {
                        const modal = bootstrap.Modal.getInstance(document.getElementById('feedbackModal'));
                        modal.hide();
                    }, 1500);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });

        document.getElementById('feedbackModal').addEventListener('hidden.bs.modal', function () {
            document.getElementById('feedbackMessage').style.display = 'none';
            document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
        });
    </script>
</body>
</html>
