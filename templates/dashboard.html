<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Titanic Survival Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Top Controls -->
    <div class="container mt-3">
        <div class="d-flex justify-content-between align-items-center">
            <a href="/" class="btn btn-outline-light" data-en="Back to Predictor" data-ar="ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖÿ™ŸÜÿ®ÿ¶">Back to Predictor</a>
            <div class="d-flex gap-2">
                <!-- Language Toggle -->
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary btn-sm lang-btn active" data-lang="en">EN</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm lang-btn" data-lang="ar">ÿπÿ±ÿ®Ÿä</button>
                </div>
                <!-- Theme Toggle -->
                <button type="button" class="btn btn-outline-secondary btn-sm" id="themeToggle">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container mt-3 mb-5">
        <div class="row">
            <div class="col-12">
                <div class="card shadow mb-4">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0 text-center" data-en="Analytics Dashboard" data-ar="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™">Analytics Dashboard</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card shadow stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-muted" data-en="Total Predictions" data-ar="ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ŸÜÿ®ÿ§ÿßÿ™">Total Predictions</h6>
                        <h2 class="text-primary">{{ total_predictions }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card shadow stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-muted" data-en="Survived" data-ar="ŸÜÿ¨Ÿàÿß">Survived</h6>
                        <h2 class="text-success">{{ survived_count }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card shadow stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-muted" data-en="Did Not Survive" data-ar="ŸÑŸÖ ŸäŸÜÿ¨Ÿàÿß">Did Not Survive</h6>
                        <h2 class="text-danger">{{ not_survived_count }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card shadow stat-card">
                    <div class="card-body text-center">
                        <h6 class="text-muted" data-en="Survival Rate" data-ar="ŸÖÿπÿØŸÑ ÿßŸÑŸÜÿ¨ÿßÿ©">Survival Rate</h6>
                        <h2 class="text-info">{{ "%.1f"|format(survival_rate) }}%</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0" data-en="Survival Distribution" data-ar="ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸÜÿ¨ÿßÿ©">Survival Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="survivalChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0" data-en="Passenger Class Distribution" data-ar="ÿ™Ÿàÿ≤Ÿäÿπ ÿØÿ±ÿ¨ÿßÿ™ ÿßŸÑÿ±ŸÉÿßÿ®">Passenger Class Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="classChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0" data-en="Gender Distribution" data-ar="ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ¨ŸÜÿ≥">Gender Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="genderChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0" data-en="User Feedback" data-ar="ÿ™ŸÇŸäŸäŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ">User Feedback</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="feedbackChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Predictions Table -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header">
                        <h5 class="mb-0" data-en="Recent Predictions" data-ar="ÿßŸÑÿ™ŸÜÿ®ÿ§ÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©">Recent Predictions</h5>
                    </div>
                    <div class="card-body">
                        {% if recent_predictions %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th data-en="Time" data-ar="ÿßŸÑŸàŸÇÿ™">Time</th>
                                        <th data-en="Class" data-ar="ÿßŸÑÿØÿ±ÿ¨ÿ©">Class</th>
                                        <th data-en="Sex" data-ar="ÿßŸÑÿ¨ŸÜÿ≥">Sex</th>
                                        <th data-en="Age" data-ar="ÿßŸÑÿπŸÖÿ±">Age</th>
                                        <th data-en="Result" data-ar="ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©">Result</th>
                                        <th data-en="Probability" data-ar="ÿßŸÑÿßÿ≠ÿ™ŸÖÿßŸÑŸäÿ©">Probability</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for p in recent_predictions %}
                                    <tr>
                                        <td>{{ p.timestamp }}</td>
                                        <td>{{ p.pclass }}</td>
                                        <td>
                                            <span data-en="{{ p.sex }}" data-ar="{% if p.sex == 'Female' %}ÿ£ŸÜÿ´Ÿâ{% else %}ÿ∞ŸÉÿ±{% endif %}">{{ p.sex }}</span>
                                        </td>
                                        <td>{{ p.age }}</td>
                                        <td>
                                            {% if p.survived %}
                                            <span class="badge bg-success" data-en="Survived" data-ar="ŸÜÿ¨ÿß">Survived</span>
                                            {% else %}
                                            <span class="badge bg-danger" data-en="Did Not Survive" data-ar="ŸÑŸÖ ŸäŸÜÿ¨Ÿè">Did Not Survive</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ "%.1f"|format(p.probability) }}%</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center text-muted py-4">
                            <p data-en="No predictions yet. Make your first prediction!" data-ar="ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÜÿ®ÿ§ÿßÿ™ ÿ®ÿπÿØ. ŸÇŸÖ ÿ®ÿ£ŸàŸÑ ÿ™ŸÜÿ®ÿ§!">No predictions yet. Make your first prediction!</p>
                            <a href="/" class="btn btn-primary" data-en="Make Prediction" data-ar="ŸÇŸÖ ÿ®ÿ™ŸÜÿ®ÿ§">Make Prediction</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie Consent Banner -->
    <div id="cookieBanner" class="cookie-banner" style="display: none;">
        <div class="cookie-content">
            <div class="cookie-icon">üç™</div>
            <div class="cookie-text">
                <p class="mb-1 fw-bold" data-en="We use cookies" data-ar="ŸÜÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸÑŸÅÿßÿ™ ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿßÿ±ÿ™ÿ®ÿßÿ∑">We use cookies</p>
                <p class="mb-0 small" data-en="This website uses cookies to store your preferences (language, theme) and improve your experience." data-ar="Ÿäÿ≥ÿ™ÿÆÿØŸÖ Ÿáÿ∞ÿß ÿßŸÑŸÖŸàŸÇÿπ ŸÖŸÑŸÅÿßÿ™ ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿßÿ±ÿ™ÿ®ÿßÿ∑ ŸÑÿ≠ŸÅÿ∏ ÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ŸÉ (ÿßŸÑŸÑÿ∫ÿ©ÿå ÿßŸÑŸÖÿ∏Ÿáÿ±) Ÿàÿ™ÿ≠ÿ≥ŸäŸÜ ÿ™ÿ¨ÿ±ÿ®ÿ™ŸÉ.">This website uses cookies to store your preferences (language, theme) and improve your experience.</p>
            </div>
            <div class="cookie-buttons">
                <button class="btn btn-success btn-sm" id="acceptCookies" data-en="Accept" data-ar="ŸÇÿ®ŸàŸÑ">Accept</button>
                <button class="btn btn-outline-secondary btn-sm" id="declineCookies" data-en="Decline" data-ar="ÿ±ŸÅÿ∂">Decline</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Cookie consent
        function showCookieBanner() {
            const consent = localStorage.getItem('cookieConsent');
            if (!consent) {
                document.getElementById('cookieBanner').style.display = 'block';
            }
        }

        document.getElementById('acceptCookies').addEventListener('click', () => {
            localStorage.setItem('cookieConsent', 'accepted');
            document.getElementById('cookieBanner').style.display = 'none';
        });

        document.getElementById('declineCookies').addEventListener('click', () => {
            localStorage.setItem('cookieConsent', 'declined');
            document.getElementById('cookieBanner').style.display = 'none';
        });

        showCookieBanner();

        // Chart.js configuration
        const isDarkMode = () => document.body.classList.contains('dark-mode');
        const getTextColor = () => isDarkMode() ? '#eaeaea' : '#666';
        const getGridColor = () => isDarkMode() ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';

        // Survival Distribution Chart
        const survivalCtx = document.getElementById('survivalChart').getContext('2d');
        const survivalChart = new Chart(survivalCtx, {
            type: 'doughnut',
            data: {
                labels: ['Survived', 'Did Not Survive'],
                datasets: [{
                    data: [{{ survived_count }}, {{ not_survived_count }}],
                    backgroundColor: ['#198754', '#dc3545'],
                    borderWidth: 2,
                    borderColor: isDarkMode() ? '#16213e' : '#fff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: getTextColor() }
                    }
                }
            }
        });

        // Class Distribution Chart
        const classCtx = document.getElementById('classChart').getContext('2d');
        const classChart = new Chart(classCtx, {
            type: 'bar',
            data: {
                labels: ['1st Class', '2nd Class', '3rd Class'],
                datasets: [{
                    label: 'Passengers',
                    data: [{{ class_counts[1] }}, {{ class_counts[2] }}, {{ class_counts[3] }}],
                    backgroundColor: ['#0d6efd', '#6610f2', '#6f42c1'],
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: getTextColor() },
                        grid: { color: getGridColor() }
                    },
                    x: {
                        ticks: { color: getTextColor() },
                        grid: { display: false }
                    }
                }
            }
        });

        // Gender Distribution Chart
        const genderCtx = document.getElementById('genderChart').getContext('2d');
        const genderChart = new Chart(genderCtx, {
            type: 'pie',
            data: {
                labels: ['Male', 'Female'],
                datasets: [{
                    data: [{{ gender_counts['Male'] }}, {{ gender_counts['Female'] }}],
                    backgroundColor: ['#0dcaf0', '#e83e8c'],
                    borderWidth: 2,
                    borderColor: isDarkMode() ? '#16213e' : '#fff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: getTextColor() }
                    }
                }
            }
        });

        // Feedback Chart
        const feedbackCtx = document.getElementById('feedbackChart').getContext('2d');
        const feedbackChart = new Chart(feedbackCtx, {
            type: 'bar',
            data: {
                labels: ['üòû Bad', 'üòê Okay', 'üòä Good', 'ü§© Excellent'],
                datasets: [{
                    label: 'Feedback',
                    data: [{{ feedback_counts['bad'] }}, {{ feedback_counts['okay'] }}, {{ feedback_counts['good'] }}, {{ feedback_counts['excellent'] }}],
                    backgroundColor: ['#dc3545', '#ffc107', '#198754', '#0d6efd'],
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: getTextColor() },
                        grid: { color: getGridColor() }
                    },
                    x: {
                        ticks: { color: getTextColor() },
                        grid: { display: false }
                    }
                }
            }
        });

        // Language switching
        let currentLang = localStorage.getItem('lang') || 'en';

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-en]').forEach(el => {
                el.textContent = el.getAttribute(`data-${lang}`);
            });

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });

            // Update chart labels
            if (lang === 'ar') {
                survivalChart.data.labels = ['ŸÜÿ¨ÿß', 'ŸÑŸÖ ŸäŸÜÿ¨Ÿè'];
                classChart.data.labels = ['ÿßŸÑÿØÿ±ÿ¨ÿ© ÿßŸÑÿ£ŸàŸÑŸâ', 'ÿßŸÑÿØÿ±ÿ¨ÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©', 'ÿßŸÑÿØÿ±ÿ¨ÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©'];
                genderChart.data.labels = ['ÿ∞ŸÉÿ±', 'ÿ£ŸÜÿ´Ÿâ'];
                feedbackChart.data.labels = ['üòû ÿ≥Ÿäÿ°', 'üòê ŸÖŸÇÿ®ŸàŸÑ', 'üòä ÿ¨ŸäÿØ', 'ü§© ŸÖŸÖÿ™ÿßÿ≤'];
            } else {
                survivalChart.data.labels = ['Survived', 'Did Not Survive'];
                classChart.data.labels = ['1st Class', '2nd Class', '3rd Class'];
                genderChart.data.labels = ['Male', 'Female'];
                feedbackChart.data.labels = ['üòû Bad', 'üòê Okay', 'üòä Good', 'ü§© Excellent'];
            }
            survivalChart.update();
            classChart.update();
            genderChart.update();
            feedbackChart.update();
        }

        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
        });

        // Theme switching
        let currentTheme = localStorage.getItem('theme') || 'light';

        function setTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('theme', theme);
            document.body.classList.toggle('dark-mode', theme === 'dark');
            document.querySelector('.theme-icon').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

            // Update charts for theme
            const textColor = theme === 'dark' ? '#eaeaea' : '#666';
            const gridColor = theme === 'dark' ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
            const borderColor = theme === 'dark' ? '#16213e' : '#fff';

            [survivalChart, genderChart].forEach(chart => {
                chart.data.datasets[0].borderColor = borderColor;
                chart.options.plugins.legend.labels.color = textColor;
                chart.update();
            });

            [classChart, feedbackChart].forEach(chart => {
                chart.options.scales.y.ticks.color = textColor;
                chart.options.scales.y.grid.color = gridColor;
                chart.options.scales.x.ticks.color = textColor;
                chart.update();
            });
        }

        document.getElementById('themeToggle').addEventListener('click', () => {
            setTheme(currentTheme === 'light' ? 'dark' : 'light');
        });

        // Initialize
        setLanguage(currentLang);
        setTheme(currentTheme);
    </script>
</body>
</html>
